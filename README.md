# URL Shortener

Простой сокращатель ссылок. Сделал чтобы разобраться с FastAPI и PostgreSQL.

## Что внутри

FastAPI + PostgreSQL + JWT авторизация. Всё в Docker, чтобы не засорять систему.

Можно регистрироваться, логиниться, создавать короткие ссылки. У каждой ссылки есть владелец, считаются переходы, можно поставить время жизни. Ещё есть валидация кастомных кодов - забанил слова типа admin/root, чтобы никто не занимал.

## Как запустить

Тебе нужен Docker и Python 3.11+.

```bash
git clone https://github.com/Flaty/url_shorter
cd url_shorter

# Поднять базу
docker-compose up -d

# Зависимости
pip install -r requirements.txt

# Сервер
uvicorn main:app --reload
```

Swagger UI на http://localhost:8000/docs

## Endpoints

Регистрация и логин:
- POST /register
- POST /login

Работа со ссылками (нужен токен):
- POST /create_url - создать короткую ссылку
- GET /{code} - редирект
- GET /stats/{code} - посмотреть статистику

## Пример

Зарегаешься, получишь токен при логине. В Swagger UI справа вверху кнопка Authorize - вставляешь туда токен. Дальше можешь создавать ссылки:

```json
{
  "url": "https://youtube.com/watch?v=dQw4w9WgXcQ",
  "custom_code": "rickroll",
  "expires_time": 24
}
```

Получишь короткую ссылку. Переходы по ней считаются, через 24 часа протухнет.

## База данных

Две таблицы. В users храню юзеров (id, username, email, хеш пароля). В urls - ссылки (код, оригинальная ссылка, клики, время создания, время истечения, айди владельца). Foreign key связывает их.

PostgreSQL выбрал потому что нужны foreign keys и нормальные транзакции. SQLite для прода не зайдёт.

## Что можно допилить

Миграции через Alembic вместо Base.metadata.create_all(). Redis для кэша популярных ссылок, снизит нагрузку на постегре. Background task для автоматической очистки протухших ссылок, сейчас они удаляются только когда кто-то попытается перейти. Rate limiting чтобы один юзер не мог создать миллион ссылок. Эндпоинт для просмотра своих ссылок. Возможность удалять свои ссылки.

## Зачем JWT

Stateless auth - сервер ничего не хранит про сессии. Токен содержит user_id, сервер просто проверяет подпись. Легко масштабировать горизонтально. Минус - нельзя отозвать токен до истечения срока, но для пет проекта терпимо.

## Зависимости

```txt
fastapi
uvicorn
sqlalchemy
psycopg2-binary
python-jose[cryptography]
bcrypt
pydantic[email]
```

## .gitignore

```
venv/
__pycache__/
*.pyc
.env
```